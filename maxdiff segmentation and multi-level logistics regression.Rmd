---
title: "Maxdiff Segmentation And Multi-level Logistics Regression"
author: "Yifei Liu"
date: "February 8, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Background

This project is built based on Google Kis Device Supervision Maxdiff project, where we have a standardard maxdiff section in questionnaire. We hope to do the maxdiff clustering using Sawtooth Latent Class software and then explore the possibility to do a supervised learning on other none maxdiff variables to train a model, i.e. segmentation typing tool algorithm. 

## Data Preparation

Read in the raw data file and the segment id generated by Sawtooth Latent Class software. Then go through all variables to identity all the potential inputs such as demographics information, attitudinal and behavioral variables which don't have any missings. Otherwise, we need to create smart variable rollups to eliminate the missing. One useful function to generate quick summary of variables is *summary()*.
```{r datasetup}
library(haven)
library(readxl)

db0 <- read_spss("C:/Users/yifei.liu/Desktop/US6633629 - Google Kids Device Supervision- MaxDiff/US6633629_Google_Kids_Supervision-quick_profile (3).sav")
id <- read_xlsx("C:/Users/yifei.liu/Desktop/US6633629 - Google Kids Device Supervision- MaxDiff/segment id.xlsx", col_names = TRUE)
# go through all variables and identity all possible inputs, including demo info, attitudinal and behavioral vairables which doesn't have missings. 
summary(db0$SUPSAT_1)

```

After going through all variables and understanding the question type, we created a list of potential inputs, saved in Excel sheet. Now read in the variable list and create the data set that we are going to build the model on. In this case, I created a data set called *db* including only potential inputs, identity, and one set of segment id. Let's first explore 3 segment solution. Here, we are going to try multi-level logistic regression model. 
```{r model}
vars <- as.character(read.csv("variable list.csv", header = TRUE)$variable)
db <- merge(db0[, c("identity", vars)], id[, c("identity", "seg3")], by = "identity")


```